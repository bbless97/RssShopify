(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
"use strict";

RideStylerShowcase.registerPlugin("Shopify", function (showcaseInstance, pluginProviderInstance, showcaseState, uiLibrary, options) {
  var shopifyProducts = [],
      errors = []; // This will create the "Build Wheel and Tire Package" button in the showcase

  function registerAction() {
    var settings = {
      isVisible: true,
      isDisabled: true
    },
        tireAction = pluginProviderInstance.registerShowcaseAction("global", "Cart", refineProducts, settings);
    showcaseInstance.app.$store.watch(function (state, getters) {
      return getters.userHasProductSelections;
    }, function (hasProduct) {
      tireAction.isDisabled = !hasProduct;
    });
  } // Get all shopify products, store them so we can cycle through them and find our products by sku later on


  function getShopifyProducts() {
    var requestType = "GET",
        endpoint = "/admin/api/2019-04/products/count.json",
        productCount,
        pageCount;

    if (window.localStorage.getItem('RsProductStore') === null) {
      sendRequest(requestType, endpoint).then(function (data) {
        productCount = data.count;

        if (productCount > 250) {
          pageCount = Math.ceil(productCount / 250);
        } else {
          pageCount = 1;
        }

        for (var i = 1; i <= pageCount; i++) {
          endpoint = "/admin/api/2019-04/products.json?limit=250&page=" + i;
          sendRequest(requestType, endpoint).then(function (data) {
            data.products.forEach(function (product) {
              shopifyProducts.push(product);
            });
            window.localStorage.setItem('RsProductStore', JSON.stringify(shopifyProducts));
          });
        }
      });
    } else {
      shopifyProducts = JSON.parse(window.localStorage.getItem('RsProductStore'));
    }
  } // Refine showcase selected products


  function refineProducts() {
    showcaseInstance.app.$store.dispatch('refineUserSelectedProducts').then(function (userRefinedWheels) {
      verifyFitments(userRefinedWheels);
    });
  } // Verify fitments in the showcase


  function verifyFitments(products) {
    var rideStylerProducts = [],
        successMessage = "Your items have been added to the cart.";
    showcaseInstance.app.$store.dispatch('orderdetails/showModal', {
      data: products
    }).then(function (verifiedProducts) {
      for (var product in verifiedProducts) {
        rideStylerProducts.push(verifiedProducts[product]);
      }

      Promise.all(rideStylerProducts.map(function (x) {
        return getProductBySku(x);
      })).then(function (products) {
        if (errors.length === 0) {
          products.forEach(function (product) {
            addProductToCart(product);
          });

          if (errors.length == 0) {
            uiLibrary.showPrompt(successMessage, goToCart, "Checkout");
          } else {
            showErrors();
          }
        } else {
          showErrors();
        }
      });
    });
  } // Check shopify for our RS showcase selected products.


  function getProductBySku(rsProduct) {
    var rsProductSku,
        rsProductQuantity = rsProduct.Quantity,
        returnProduct;

    if (rsProduct.type == "wheel") {
      rsProductSku = rsProduct.PartNumber;
    } else {
      rsProductSku = rsProduct.TireFitmentPartNumber;
    }

    for (var i = 0; i < shopifyProducts.length; i++) {
      for (var j = 0; j < shopifyProducts[i].variants.length; j++) {
        if (shopifyProducts[i].variants[j].sku === rsProductSku) {
          returnProduct = shopifyProducts[i].variants[j];
          returnProduct.quantity = rsProductQuantity;
          return returnProduct;
        }
      }
    }

    errors.push("Sorry, we could not find your " + rsProduct.type + " in our inventory. \n");
  } // Add our products to the shopify cart


  function addProductToCart(product) {
    var request = new XMLHttpRequest(),
        endpoint = "/cart/add.js",
        formData = new FormData(),
        url;

    if (product !== undefined) {
      formData.append("form_type", "product");
      formData.append("id", product.id);
      formData.append("quantity", product.quantity);
      url = "https://" + options.url + endpoint;
      request.open("POST", url, false);
      request.send(formData);

      request.onreadystatechange = function () {
        if (request.readyState === 4 && request.status === 200) {
          JSON.parse(request.response);
        } else {
          errors.push("There was an issue adding " + product.name + " to your cart. \n");
        }
      };
    }
  } // Template for api requests


  function sendRequest(type, endpoint, formData, sync) {
    var request = new XMLHttpRequest(),
        url = "https://" + options.url + endpoint;
    request.open(type, url, sync || true);
    request.setRequestHeader('Authorization', "Basic " + window.btoa(options.apiKey + ":" + options.password));
    request.send(formData);
    return new Promise(function (resolve) {
      request.onreadystatechange = function () {
        if (request.readyState === 4 && request.status === 200) {
          resolve(JSON.parse(request.response));
        }
      };
    });
  } // Redirect to shopify cart


  function goToCart() {
    window.location.href = "/cart";
  } // Uses our UiLibrary to display errors


  function showErrors() {
    var errorMessage, displayMessage;

    for (var i = 0; i < errors.length; i++) {
      if (errorMessage !== undefined) {
        errorMessage += errors[i] + "\n";
      } else {
        errorMessage = errors[i];
      }
    }

    ;
    displayMessage = errorMessage.replace(/\n/g, "<br />");
    uiLibrary.showMessage(displayMessage);
    errors = [];
  }

  registerAction();
  getShopifyProducts();
});

},{}]},{},[1])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJSc1Nob3BpZnkuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7OztBQ0FBLGtCQUFrQixDQUFDLGNBQW5CLENBQWtDLFNBQWxDLEVBQTZDLFVBQVUsZ0JBQVYsRUFBNEIsc0JBQTVCLEVBQW9ELGFBQXBELEVBQW1FLFNBQW5FLEVBQThFLE9BQTlFLEVBQXNGO0FBQy9ILE1BQUksZUFBZSxHQUFHLEVBQXRCO0FBQUEsTUFDQSxNQUFNLEdBQUcsRUFEVCxDQUQrSCxDQUkvSDs7QUFDQSxXQUFTLGNBQVQsR0FBeUI7QUFDckIsUUFBTSxRQUFRLEdBQUc7QUFBRSxNQUFBLFNBQVMsRUFBRSxJQUFiO0FBQW1CLE1BQUEsVUFBVSxFQUFFO0FBQS9CLEtBQWpCO0FBQUEsUUFDQSxVQUFVLEdBQUcsc0JBQXNCLENBQUMsc0JBQXZCLENBQThDLFFBQTlDLEVBQXdELE1BQXhELEVBQWdFLGNBQWhFLEVBQWdGLFFBQWhGLENBRGI7QUFHQSxJQUFBLGdCQUFnQixDQUFDLEdBQWpCLENBQXFCLE1BQXJCLENBQTRCLEtBQTVCLENBQWtDLFVBQVMsS0FBVCxFQUFnQixPQUFoQixFQUF5QjtBQUN2RCxhQUFPLE9BQU8sQ0FBQyx3QkFBZjtBQUNILEtBRkQsRUFFRyxVQUFVLFVBQVYsRUFBc0I7QUFDckIsTUFBQSxVQUFVLENBQUMsVUFBWCxHQUF3QixDQUFDLFVBQXpCO0FBQ0gsS0FKRDtBQUtILEdBZDhILENBZ0IvSDs7O0FBQ0EsV0FBUyxrQkFBVCxHQUE2QjtBQUN6QixRQUFJLFdBQVcsR0FBRyxLQUFsQjtBQUFBLFFBQ0EsUUFBUSxHQUFHLHdDQURYO0FBQUEsUUFFQSxZQUZBO0FBQUEsUUFHQSxTQUhBOztBQUtBLFFBQUcsTUFBTSxDQUFDLFlBQVAsQ0FBb0IsT0FBcEIsQ0FBNEIsZ0JBQTVCLE1BQWtELElBQXJELEVBQTBEO0FBQ3RELE1BQUEsV0FBVyxDQUFDLFdBQUQsRUFBYyxRQUFk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QUNyQixDQWxMRCIsImZpbGUiOiJnZW5lcmF0ZWQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uKCl7ZnVuY3Rpb24gcihlLG4sdCl7ZnVuY3Rpb24gbyhpLGYpe2lmKCFuW2ldKXtpZighZVtpXSl7dmFyIGM9XCJmdW5jdGlvblwiPT10eXBlb2YgcmVxdWlyZSYmcmVxdWlyZTtpZighZiYmYylyZXR1cm4gYyhpLCEwKTtpZih1KXJldHVybiB1KGksITApO3ZhciBhPW5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIraStcIidcIik7dGhyb3cgYS5jb2RlPVwiTU9EVUxFX05PVF9GT1VORFwiLGF9dmFyIHA9bltpXT17ZXhwb3J0czp7fX07ZVtpXVswXS5jYWxsKHAuZXhwb3J0cyxmdW5jdGlvbihyKXt2YXIgbj1lW2ldWzFdW3JdO3JldHVybiBvKG58fHIpfSxwLHAuZXhwb3J0cyxyLGUsbix0KX1yZXR1cm4gbltpXS5leHBvcnRzfWZvcih2YXIgdT1cImZ1bmN0aW9uXCI9PXR5cGVvZiByZXF1aXJlJiZyZXF1aXJlLGk9MDtpPHQubGVuZ3RoO2krKylvKHRbaV0pO3JldHVybiBvfXJldHVybiByfSkoKSIsIlJpZGVTdHlsZXJTaG93Y2FzZS5yZWdpc3RlclBsdWdpbihcIlNob3BpZnlcIiwgZnVuY3Rpb24gKHNob3djYXNlSW5zdGFuY2UsIHBsdWdpblByb3ZpZGVySW5zdGFuY2UsIHNob3djYXNlU3RhdGUsIHVpTGlicmFyeSwgb3B0aW9ucyl7XHJcbiAgICBsZXQgc2hvcGlmeVByb2R1Y3RzID0gW10sXHJcbiAgICBlcnJvcnMgPSBbXTtcclxuICAgIFxyXG4gICAgLy8gVGhpcyB3aWxsIGNyZWF0ZSB0aGUgXCJCdWlsZCBXaGVlbCBhbmQgVGlyZSBQYWNrYWdlXCIgYnV0dG9uIGluIHRoZSBzaG93Y2FzZVxyXG4gICAgZnVuY3Rpb24gcmVnaXN0ZXJBY3Rpb24oKXtcclxuICAgICAgICBjb25zdCBzZXR0aW5ncyA9IHsgaXNWaXNpYmxlOiB0cnVlLCBpc0Rpc2FibGVkOiB0cnVlfSxcclxuICAgICAgICB0aXJlQWN0aW9uID0gcGx1Z2luUHJvdmlkZXJJbnN0YW5jZS5yZWdpc3RlclNob3djYXNlQWN0aW9uKFwiZ2xvYmFsXCIsIFwiQ2FydFwiLCByZWZpbmVQcm9kdWN0cywgc2V0dGluZ3MpO1xyXG5cclxuICAgICAgICBzaG93Y2FzZUluc3RhbmNlLmFwcC4kc3RvcmUud2F0Y2goZnVuY3Rpb24oc3RhdGUsIGdldHRlcnMpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGdldHRlcnMudXNlckhhc1Byb2R1Y3RTZWxlY3Rpb25zO1xyXG4gICAgICAgIH0sIGZ1bmN0aW9uIChoYXNQcm9kdWN0KSB7XHJcbiAgICAgICAgICAgIHRpcmVBY3Rpb24uaXNEaXNhYmxlZCA9ICFoYXNQcm9kdWN0O1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIEdldCBhbGwgc2hvcGlmeSBwcm9kdWN0cywgc3RvcmUgdGhlbSBzbyB3ZSBjYW4gY3ljbGUgdGhyb3VnaCB0aGVtIGFuZCBmaW5kIG91ciBwcm9kdWN0cyBieSBza3UgbGF0ZXIgb25cclxuICAgIGZ1bmN0aW9uIGdldFNob3BpZnlQcm9kdWN0cygpeyBcclxuICAgICAgICBsZXQgcmVxdWVzdFR5cGUgPSBcIkdFVFwiLFxyXG4gICAgICAgIGVuZHBvaW50ID0gXCIvYWRtaW4vYXBpLzIwMTktMDQvcHJvZHVjdHMvY291bnQuanNvblwiLFxyXG4gICAgICAgIHByb2R1Y3RDb3VudCxcclxuICAgICAgICBwYWdlQ291bnQ7XHJcblxyXG4gICAgICAgIGlmKHdpbmRvdy5sb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnUnNQcm9kdWN0U3RvcmUnKSA9PT0gbnVsbCl7XHJcbiAgICAgICAgICAgIHNlbmRSZXF1ZXN0KHJlcXVlc3RUeXBlLCBlbmRwb2ludCkudGhlbihmdW5jdGlvbihkYXRhKXtcclxuICAgICAgICAgICAgICAgIHByb2R1Y3RDb3VudCA9IGRhdGEuY291bnQ7XHJcbiAgICAgICAgICAgICAgICBpZihwcm9kdWN0Q291bnQgPiAyNTApe1xyXG4gICAgICAgICAgICAgICAgICAgIHBhZ2VDb3VudCA9IE1hdGguY2VpbChwcm9kdWN0Q291bnQgLyAyNTApO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBwYWdlQ291bnQgPSAxOyAgIFxyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGZvcihsZXQgaSA9IDE7IGkgPD0gcGFnZUNvdW50OyBpKyspe1xyXG4gICAgICAgICAgICAgICAgICAgIGVuZHBvaW50ID0gXCIvYWRtaW4vYXBpLzIwMTktMDQvcHJvZHVjdHMuanNvbj9saW1pdD0yNTAmcGFnZT1cIiArIGk7XHJcbiAgICAgICAgICAgICAgICAgICAgc2VuZFJlcXVlc3QocmVxdWVzdFR5cGUsIGVuZHBvaW50KS50aGVuKGZ1bmN0aW9uKGRhdGEpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhLnByb2R1Y3RzLmZvckVhY2goZnVuY3Rpb24ocHJvZHVjdCl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaG9waWZ5UHJvZHVjdHMucHVzaChwcm9kdWN0KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cubG9jYWxTdG9yYWdlLnNldEl0ZW0oJ1JzUHJvZHVjdFN0b3JlJywgSlNPTi5zdHJpbmdpZnkoc2hvcGlmeVByb2R1Y3RzKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHNob3BpZnlQcm9kdWN0cyA9IEpTT04ucGFyc2Uod2luZG93LmxvY2FsU3RvcmFnZS5nZXRJdGVtKCdSc1Byb2R1Y3RTdG9yZScpKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLy8gUmVmaW5lIHNob3djYXNlIHNlbGVjdGVkIHByb2R1Y3RzXHJcbiAgICBmdW5jdGlvbiByZWZpbmVQcm9kdWN0cygpe1xyXG4gICAgICAgIHNob3djYXNlSW5zdGFuY2UuYXBwLiRzdG9yZS5kaXNwYXRjaCgncmVmaW5lVXNlclNlbGVjdGVkUHJvZHVjdHMnKS50aGVuKGZ1bmN0aW9uKHVzZXJSZWZpbmVkV2hlZWxzKXtcclxuICAgICAgICAgICAgdmVyaWZ5Rml0bWVudHModXNlclJlZmluZWRXaGVlbHMpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIFZlcmlmeSBmaXRtZW50cyBpbiB0aGUgc2hvd2Nhc2VcclxuICAgIGZ1bmN0aW9uIHZlcmlmeUZpdG1lbnRzKHByb2R1Y3RzKXtcclxuICAgICAgICBsZXQgcmlkZVN0eWxlclByb2R1Y3RzID0gW10sXHJcbiAgICAgICAgc3VjY2Vzc01lc3NhZ2UgPSBcIllvdXIgaXRlbXMgaGF2ZSBiZWVuIGFkZGVkIHRvIHRoZSBjYXJ0LlwiO1xyXG5cclxuICAgICAgICBzaG93Y2FzZUluc3RhbmNlLmFwcC4kc3RvcmUuZGlzcGF0Y2goJ29yZGVyZGV0YWlscy9zaG93TW9kYWwnLCB7XHJcbiAgICAgICAgICAgIGRhdGE6IHByb2R1Y3RzXHJcbiAgICAgICAgfSkudGhlbihmdW5jdGlvbih2ZXJpZmllZFByb2R1Y3RzKXtcclxuXHJcbiAgICAgICAgICAgIGZvcihjb25zdCBwcm9kdWN0IGluIHZlcmlmaWVkUHJvZHVjdHMpe1xyXG4gICAgICAgICAgICAgICAgcmlkZVN0eWxlclByb2R1Y3RzLnB1c2godmVyaWZpZWRQcm9kdWN0c1twcm9kdWN0XSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIFByb21pc2UuYWxsKHJpZGVTdHlsZXJQcm9kdWN0cy5tYXAoeCA9PiBnZXRQcm9kdWN0QnlTa3UoeCkpKS50aGVuKGZ1bmN0aW9uKHByb2R1Y3RzKXtcclxuICAgICAgICAgICAgICAgIGlmKGVycm9ycy5sZW5ndGggPT09IDApeyAgICBcclxuICAgICAgICAgICAgICAgICAgICBwcm9kdWN0cy5mb3JFYWNoKGZ1bmN0aW9uKHByb2R1Y3Qpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBhZGRQcm9kdWN0VG9DYXJ0KHByb2R1Y3QpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmKGVycm9ycy5sZW5ndGggPT0gMCl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHVpTGlicmFyeS5zaG93UHJvbXB0KHN1Y2Nlc3NNZXNzYWdlLCBnb1RvQ2FydCwgXCJDaGVja291dFwiKTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzaG93RXJyb3JzKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBzaG93RXJyb3JzKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIENoZWNrIHNob3BpZnkgZm9yIG91ciBSUyBzaG93Y2FzZSBzZWxlY3RlZCBwcm9kdWN0cy5cclxuICAgIGZ1bmN0aW9uIGdldFByb2R1Y3RCeVNrdShyc1Byb2R1Y3QpeyBcclxuICAgICAgICBsZXQgcnNQcm9kdWN0U2t1LFxyXG4gICAgICAgIHJzUHJvZHVjdFF1YW50aXR5ID0gcnNQcm9kdWN0LlF1YW50aXR5LFxyXG4gICAgICAgIHJldHVyblByb2R1Y3Q7XHJcblxyXG4gICAgICAgIGlmKHJzUHJvZHVjdC50eXBlID09IFwid2hlZWxcIil7XHJcbiAgICAgICAgICAgIHJzUHJvZHVjdFNrdSA9IHJzUHJvZHVjdC5QYXJ0TnVtYmVyO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHJzUHJvZHVjdFNrdSA9IHJzUHJvZHVjdC5UaXJlRml0bWVudFBhcnROdW1iZXI7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgICAgIGZvcihsZXQgaSA9IDA7IGkgPCBzaG9waWZ5UHJvZHVjdHMubGVuZ3RoOyBpKyspe1xyXG4gICAgICAgICAgICBmb3IobGV0IGogPSAwOyBqIDwgc2hvcGlmeVByb2R1Y3RzW2ldLnZhcmlhbnRzLmxlbmd0aDsgaisrKXtcclxuICAgICAgICAgICAgICAgIGlmKHNob3BpZnlQcm9kdWN0c1tpXS52YXJpYW50c1tqXS5za3UgPT09IHJzUHJvZHVjdFNrdSl7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuUHJvZHVjdCA9IHNob3BpZnlQcm9kdWN0c1tpXS52YXJpYW50c1tqXTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm5Qcm9kdWN0LnF1YW50aXR5ID0gcnNQcm9kdWN0UXVhbnRpdHk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJldHVyblByb2R1Y3Q7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGVycm9ycy5wdXNoKFwiU29ycnksIHdlIGNvdWxkIG5vdCBmaW5kIHlvdXIgXCIgKyByc1Byb2R1Y3QudHlwZSArIFwiIGluIG91ciBpbnZlbnRvcnkuIFxcblwiKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBBZGQgb3VyIHByb2R1Y3RzIHRvIHRoZSBzaG9waWZ5IGNhcnRcclxuICAgIGZ1bmN0aW9uIGFkZFByb2R1Y3RUb0NhcnQocHJvZHVjdCl7IFxyXG4gICAgICAgIGxldCByZXF1ZXN0ID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCksXHJcbiAgICAgICAgZW5kcG9pbnQgPSBcIi9jYXJ0L2FkZC5qc1wiLFxyXG4gICAgICAgIGZvcm1EYXRhID0gbmV3IEZvcm1EYXRhKCksXHJcbiAgICAgICAgdXJsO1xyXG5cclxuICAgICAgICBpZihwcm9kdWN0ICE9PSB1bmRlZmluZWQpe1xyXG4gICAgICAgICAgICBmb3JtRGF0YS5hcHBlbmQoXCJmb3JtX3R5cGVcIiwgXCJwcm9kdWN0XCIpO1xyXG4gICAgICAgICAgICBmb3JtRGF0YS5hcHBlbmQoXCJpZFwiLCBwcm9kdWN0LmlkKTtcclxuICAgICAgICAgICAgZm9ybURhdGEuYXBwZW5kKFwicXVhbnRpdHlcIiwgcHJvZHVjdC5xdWFudGl0eSk7XHJcblxyXG4gICAgICAgICAgICB1cmwgPSBcImh0dHBzOi8vXCIgKyBvcHRpb25zLnVybCArIGVuZHBvaW50O1xyXG4gICAgICAgICAgICByZXF1ZXN0Lm9wZW4oXCJQT1NUXCIsIHVybCwgZmFsc2UpO1xyXG4gICAgICAgICAgICByZXF1ZXN0LnNlbmQoZm9ybURhdGEpO1xyXG4gICAgICAgICAgICByZXF1ZXN0Lm9ucmVhZHlzdGF0ZWNoYW5nZSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgaWYocmVxdWVzdC5yZWFkeVN0YXRlID09PSA0ICYmIHJlcXVlc3Quc3RhdHVzID09PSAyMDApIHtcclxuICAgICAgICAgICAgICAgICAgICBKU09OLnBhcnNlKHJlcXVlc3QucmVzcG9uc2UpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBlcnJvcnMucHVzaChcIlRoZXJlIHdhcyBhbiBpc3N1ZSBhZGRpbmcgXCIgKyBwcm9kdWN0Lm5hbWUgKyBcIiB0byB5b3VyIGNhcnQuIFxcblwiKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLy8gVGVtcGxhdGUgZm9yIGFwaSByZXF1ZXN0c1xyXG4gICAgZnVuY3Rpb24gc2VuZFJlcXVlc3QodHlwZSwgZW5kcG9pbnQsIGZvcm1EYXRhLCBzeW5jKXsgXHJcbiAgICAgICAgbGV0IHJlcXVlc3QgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKSxcclxuICAgICAgICB1cmwgPSBcImh0dHBzOi8vXCIgKyBvcHRpb25zLnVybCArIGVuZHBvaW50O1xyXG5cclxuICAgICAgICByZXF1ZXN0Lm9wZW4odHlwZSwgdXJsLCBzeW5jIHx8IHRydWUpO1xyXG4gICAgICAgIHJlcXVlc3Quc2V0UmVxdWVzdEhlYWRlcignQXV0aG9yaXphdGlvbicsIFwiQmFzaWMgXCIgKyB3aW5kb3cuYnRvYShvcHRpb25zLmFwaUtleSArIFwiOlwiICsgb3B0aW9ucy5wYXNzd29yZCkpO1xyXG4gICAgICAgIHJlcXVlc3Quc2VuZChmb3JtRGF0YSk7XHJcblxyXG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlKXtcclxuICAgICAgICAgICAgcmVxdWVzdC5vbnJlYWR5c3RhdGVjaGFuZ2UgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgIGlmKHJlcXVlc3QucmVhZHlTdGF0ZSA9PT0gNCAmJiByZXF1ZXN0LnN0YXR1cyA9PT0gMjAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShKU09OLnBhcnNlKHJlcXVlc3QucmVzcG9uc2UpKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBSZWRpcmVjdCB0byBzaG9waWZ5IGNhcnRcclxuICAgIGZ1bmN0aW9uIGdvVG9DYXJ0KCl7IFxyXG4gICAgICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gXCIvY2FydFwiO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIFVzZXMgb3VyIFVpTGlicmFyeSB0byBkaXNwbGF5IGVycm9yc1xyXG4gICAgZnVuY3Rpb24gc2hvd0Vycm9ycygpe1xyXG4gICAgICAgIGxldCBlcnJvck1lc3NhZ2UsXHJcbiAgICAgICAgZGlzcGxheU1lc3NhZ2U7XHJcblxyXG4gICAgICAgIGZvcihsZXQgaT0wO2k8ZXJyb3JzLmxlbmd0aDtpKyspe1xyXG4gICAgICAgICAgICBpZihlcnJvck1lc3NhZ2UgIT09IHVuZGVmaW5lZCl7XHJcbiAgICAgICAgICAgICAgICBlcnJvck1lc3NhZ2UgKz0gKGVycm9yc1tpXSArIFwiXFxuXCIpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgZXJyb3JNZXNzYWdlID0gZXJyb3JzW2ldO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgICAgICBcclxuICAgICAgICBkaXNwbGF5TWVzc2FnZSA9IGVycm9yTWVzc2FnZS5yZXBsYWNlKC9cXG4vZywgXCI8YnIgLz5cIik7XHJcbiAgICAgICAgdWlMaWJyYXJ5LnNob3dNZXNzYWdlKGRpc3BsYXlNZXNzYWdlKTtcclxuICAgICAgICBlcnJvcnMgPSBbXTtcclxuICAgIH1cclxuXHJcbiAgICByZWdpc3RlckFjdGlvbigpO1xyXG4gICAgZ2V0U2hvcGlmeVByb2R1Y3RzKCk7XHJcbn0pO1xyXG4iXX0=
